import joblib
import pandas as pd

# Load model and encoders
clf = joblib.load('exploit_model.pkl')
le_vuln = joblib.load('le_vuln.pkl')
le_sev = joblib.load('le_sev.pkl')
le_user = joblib.load('le_user.pkl')
le_label = joblib.load('le_label.pkl')

# Example Bandit findings (demo)
findings = pd.DataFrame([
    {'vuln_type':'hardcoded_secret','severity':'HIGH','user_input':'No'},
    {'vuln_type':'eval','severity':'HIGH','user_input':'Yes'},
    {'vuln_type':'subprocess_call','severity':'HIGH','user_input':'Yes'}
])

# Encode features
findings['vuln_type_enc'] = le_vuln.transform(findings['vuln_type'])
findings['severity_enc'] = le_sev.transform(findings['severity'])
findings['user_input_enc'] = le_user.transform(findings['user_input'])
X_pred = findings[['vuln_type_enc','severity_enc','user_input_enc']]

# Predict exploitability
preds_enc = clf.predict(X_pred)
findings['predicted_exploitability'] = le_label.inverse_transform(preds_enc)

print(findings[['vuln_type','severity','user_input','predicted_exploitability']])
